############################################################
# ðŸ“˜ æ–‡ä»¶è¯´æ˜Žï¼š
# æœ¬æ–‡ä»¶å®žçŽ°çš„åŠŸèƒ½ï¼šæµ‹è¯•ç”¨ä¾‹ï¼šéªŒè¯ test_project_records ç›¸å…³é€»è¾‘çš„æ­£ç¡®æ€§ä¸Žå›žå½’ã€‚
#
# ðŸ“‹ ç¨‹åºæ•´ä½“ä¼ªä»£ç ï¼ˆä¸­æ–‡ï¼‰ï¼š
# 1. åˆå§‹åŒ–ä¸»è¦ä¾èµ–ä¸Žå˜é‡
# 2. åŠ è½½è¾“å…¥æ•°æ®æˆ–æŽ¥æ”¶å¤–éƒ¨è¯·æ±‚
# 3. æ‰§è¡Œä¸»è¦é€»è¾‘æ­¥éª¤ï¼ˆå¦‚è®¡ç®—ã€å¤„ç†ã€è®­ç»ƒã€æ¸²æŸ“ç­‰ï¼‰
# 4. è¾“å‡ºæˆ–è¿”å›žç»“æžœ
# 5. å¼‚å¸¸å¤„ç†ä¸Žèµ„æºé‡Šæ”¾
#
# ðŸ”„ ç¨‹åºæµç¨‹å›¾ï¼ˆé€»è¾‘æµï¼‰ï¼š
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  è¾“å…¥æ•°æ® â”‚
# â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
#       â†“
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  æ ¸å¿ƒå¤„ç†é€»è¾‘ â”‚
# â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
#       â†“
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚  è¾“å‡ºç»“æžœ â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# ðŸ“Š æ•°æ®ç®¡é“è¯´æ˜Žï¼š
# æ•°æ®æµå‘ï¼šè¾“å…¥æº â†’ æ•°æ®æ¸…æ´—/è½¬æ¢ â†’ æ ¸å¿ƒç®—æ³•æ¨¡å— â†’ è¾“å‡ºç›®æ ‡ï¼ˆæ–‡ä»¶ / æŽ¥å£ / ç»ˆç«¯ï¼‰
#
# ðŸ§© æ–‡ä»¶ç»“æž„ï¼š
# - ä¾èµ–ï¼ˆæ ‡å‡†åº“ï¼‰ï¼šjson, os, sys
# - ä¾èµ–ï¼ˆç¬¬ä¸‰æ–¹ï¼‰ï¼šæ— 
# - ä¾èµ–ï¼ˆæœ¬åœ°ï¼‰ï¼šæ— 
#
# ðŸ•’ åˆ›å»ºæ—¶é—´ï¼š2025-12-19
############################################################

import os
import sys
import json

REPO_ROOT = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
SRC_DIR = os.path.join(REPO_ROOT, "src")
sys.path.insert(0, REPO_ROOT)
sys.path.insert(0, SRC_DIR)


def _read(path: str) -> str:
    with open(os.path.join(REPO_ROOT, path), "r", encoding="utf-8") as f:
        return f.read()


def test_records_no_ascii_question_marks() -> bool:
    print("\n?? æµ‹è¯•: é¡¹ç›®è®°å½•æ–‡ä»¶æ—  ASCII é—®å·å ä½ç¬¦")
    try:
        history_raw = _read("åŽ†å²è®°å½•.json")
        progress_raw = _read("ä»»åŠ¡è¿›åº¦.json")

        # JSON å¯è§£æž
        json.loads(history_raw)
        json.loads(progress_raw)

        # é˜²æ­¢â€œç¼–ç æ›¿æ¢å†™å…¥â€å¯¼è‡´çš„ ?? ä¹±ç 
        assert "?" not in history_raw, "åŽ†å²è®°å½•.json å« ASCII '?'ï¼Œç–‘ä¼¼ä¹±ç å ä½ç¬¦"
        assert "?" not in progress_raw, "ä»»åŠ¡è¿›åº¦.json å« ASCII '?'ï¼Œç–‘ä¼¼ä¹±ç å ä½ç¬¦"

        print("? é€šè¿‡: è®°å½•æ–‡ä»¶å¯è§£æžä¸”æ—  ASCII '?'")
        return True
    except Exception as e:
        print(f"? å¤±è´¥: {e}")
        return False


def run_all_tests() -> bool:
    print("=" * 60)
    print("?? é¡¹ç›®è®°å½•æ–‡ä»¶å›žå½’æµ‹è¯•")
    print("=" * 60)
    ok = test_records_no_ascii_question_marks()
    print("\n" + "=" * 60)
    print(f"?? æµ‹è¯•ç»“æžœ: {'é€šè¿‡' if ok else 'å¤±è´¥'}")
    print("=" * 60)
    return ok


if __name__ == "__main__":
    success = run_all_tests()
    sys.exit(0 if success else 1)
