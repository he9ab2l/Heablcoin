%% å¯è§†åŒ–ç³»ç»Ÿæ¶æ„ - è‡ªåŠ¨ç”Ÿæˆï¼ˆæ›´æ–°æ—¶é—´ï¼š2025-12-18 14:18:00ï¼‰
%% å¯ç›´æ¥å¯¼å…¥ https://www.mermaidchart.com/
%% Heablcoin - æ™ºèƒ½åŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“ç³»ç»Ÿ

graph TB
    %% æ ·å¼å®šä¹‰
    classDef datasource fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#0d47a1
    classDef collector fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#1b5e20
    classDef processor fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#4a148c
    classDef formatter fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#e65100
    classDef messagebus fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#b71c1c
    classDef consumer fill:#fce4ec,stroke:#c2185b,stroke-width:2px,color:#880e4f
    classDef terminal fill:#eceff1,stroke:#546e7a,stroke-width:2px,color:#263238
    classDef utils fill:#fffde7,stroke:#fbc02d,stroke-width:2px,color:#f57f17
    classDef storage fill:#e0f2f1,stroke:#00796b,stroke-width:2px,color:#004d40

    %% ç³»ç»Ÿå…¥å£
    SystemArchitecture["ğŸª™ Heablcoin<br/>æ™ºèƒ½åŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“ç³»ç»Ÿ"]

    subgraph DataSources["ğŸ“¡ æ•°æ®æºå±‚ DataSources"]
        DS_Binance["Binance API<br/>ç°è´§/åˆçº¦"]
        DS_OKX["OKX API<br/>(æ‰©å±•ä¸­)"]
        DS_Bybit["Bybit API<br/>(æ‰©å±•ä¸­)"]
        DS_Config[".env é…ç½®æ–‡ä»¶"]
        DS_Redis["Redis<br/>äº‘ç«¯é˜Ÿåˆ—"]
    end

    subgraph Collectors["ğŸ” æ•°æ®é‡‡é›†å±‚ Collectors"]
        C_CCXT["ccxt ç»Ÿä¸€æ¥å£<br/>exchange_adapter.py"]
        C_DataProvider["æ•°æ®æä¾›å™¨<br/>data_provider.py"]
        C_PersonalData["ä¸ªäººæ•°æ®é‡‡é›†<br/>personal_analytics/data_provider.py"]
    end

    subgraph Processors["âš™ï¸ æ•°æ®å¤„ç†å±‚ Processors"]
        subgraph Indicators["æŠ€æœ¯æŒ‡æ ‡è®¡ç®—"]
            P_Trend["è¶‹åŠ¿æŒ‡æ ‡<br/>MA/EMA/ADX"]
            P_Momentum["åŠ¨é‡æŒ‡æ ‡<br/>RSI/MACD/Stoch"]
            P_Volatility["æ³¢åŠ¨ç‡æŒ‡æ ‡<br/>ATR/BB"]
            P_Volume["æˆäº¤é‡æŒ‡æ ‡<br/>OBV/VWAP"]
        end
        
        subgraph Analysis["åˆ†ææ¨¡å—"]
            P_Technical["æŠ€æœ¯åˆ†æ<br/>technical_summary.py"]
            P_Sentiment["æƒ…ç»ªåˆ†æ<br/>sentiment.py"]
            P_Patterns["å½¢æ€è¯†åˆ«<br/>patterns.py"]
            P_Signals["ä¿¡å·ç”Ÿæˆ<br/>trading_signals.py"]
        end
        
        subgraph PersonalAnalysis["ä¸ªäººç»©æ•ˆåˆ†æ"]
            P_Performance["ç»©æ•ˆè®¡ç®—<br/>performance.py"]
            P_Risk["é£é™©åˆ†æ<br/>risk.py"]
            P_Attribution["å½’å› åˆ†æ<br/>attribution.py"]
            P_Behavior["è¡Œä¸ºåˆ†æ<br/>behavior.py"]
        end
    end

    subgraph Orchestration["ğŸ¯ AIç¼–æ’å±‚ Orchestration"]
        O_Router["ä»»åŠ¡è·¯ç”±å™¨<br/>router.py"]
        O_AIRoles["AIè§’è‰²å®šä¹‰<br/>ai_roles.py"]
        O_Providers["AIæä¾›å•†<br/>providers.py"]
        O_Tasks["ä»»åŠ¡å®šä¹‰<br/>tasks.py"]
    end

    subgraph Cloud["â˜ï¸ äº‘ç«¯ä»»åŠ¡å±‚ Cloud"]
        CL_Scheduler["å®šæ—¶è°ƒåº¦å™¨<br/>scheduler.py"]
        CL_Publisher["ä»»åŠ¡å‘å¸ƒå™¨<br/>enhanced_publisher.py"]
        CL_Executor["ä»»åŠ¡æ‰§è¡Œå™¨<br/>task_executor.py"]
        CL_APIManager["APIç®¡ç†å™¨<br/>api_manager.py"]
    end

    subgraph Formatters["ğŸ“¦ æ ¼å¼åŒ–å±‚ Formatters"]
        F_Report["æŠ¥å‘Šç”Ÿæˆ<br/>report_generator.py"]
        F_Flexible["çµæ´»æŠ¥å‘Š<br/>flexible_report/"]
        F_JSON["JSONè¾“å‡º"]
        F_Markdown["Markdownè¾“å‡º"]
        F_HTML["HTMLè¾“å‡º"]
    end

    subgraph MessageBus["ğŸ”” æ¶ˆæ¯ä¸­å¿ƒ MessageBus"]
        MB_MCP["MCP Server<br/>Heablcoin.py"]
        MB_Tools["MCPå·¥å…·æ³¨å†Œ<br/>mcp_tools.py"]
    end

    subgraph Consumers["ğŸ“¥ æ¶ˆè´¹å±‚ Consumers"]
        CO_Trading["äº¤æ˜“æ‰§è¡Œ<br/>place_order"]
        CO_Analysis["åˆ†ææŸ¥è¯¢<br/>get_analysis"]
        CO_Account["è´¦æˆ·ç®¡ç†<br/>get_account"]
        CO_Learning["å­¦ä¹ æ¨¡å—<br/>learning/"]
    end

    subgraph Storage["ğŸ’¾ å­˜å‚¨å±‚ Storage"]
        ST_File["æ–‡ä»¶å­˜å‚¨<br/>file_adapter.py"]
        ST_Redis["Rediså­˜å‚¨<br/>redis_adapter.py"]
        ST_Email["é‚®ä»¶å‘é€<br/>email_adapter.py"]
        ST_Notion["NotionåŒæ­¥<br/>notion_adapter.py"]
    end

    subgraph Utils["ğŸ”§ å·¥å…·å±‚ Utils"]
        U_Logger["æ™ºèƒ½æ—¥å¿—<br/>smart_logger.py"]
        U_Cache["æ™ºèƒ½ç¼“å­˜<br/>smart_cache.py"]
        U_RiskMgmt["é£é™©ç®¡ç†<br/>risk_management.py"]
        U_Backtest["å›æµ‹å¼•æ“<br/>backtesting.py"]
        U_Notifier["é€šçŸ¥å·¥å…·<br/>notifier.py"]
        U_PerfMon["æ€§èƒ½ç›‘æ§<br/>performance_monitor.py"]
    end

    subgraph UserTerminals["ğŸ‘¥ ç”¨æˆ·ç»ˆç«¯å±‚ UserTerminals"]
        UT_Claude["Claude Desktop<br/>MCPå®¢æˆ·ç«¯"]
        UT_Windsurf["Windsurf IDE<br/>MCPå®¢æˆ·ç«¯"]
        UT_Terminal["ç»ˆç«¯æµ‹è¯•<br/>Heablcoin-test.py"]
        UT_Qinglong["é’é¾™é¢æ¿<br/>qinglong_worker.py"]
    end

     subgraph Documentation["ğŸ“š æ–‡æ¡£å±‚ Documentation"]
         DOC_User["ç”¨æˆ·æ–‡æ¡£<br/>docs/user/"]
         DOC_Dev["å¼€å‘è€…æ–‡æ¡£<br/>docs/developer/"]
     end

    %% æ•°æ®æµè¿æ¥ - æ•°æ®æºåˆ°é‡‡é›†å±‚ï¼ˆè“è‰²ï¼‰
    DS_Binance -->|"è¡Œæƒ…/Kçº¿"| C_CCXT
    DS_OKX -.->|"æ‰©å±•ä¸­"| C_CCXT
    DS_Bybit -.->|"æ‰©å±•ä¸­"| C_CCXT
    DS_Config -->|"é…ç½®åŠ è½½"| MB_MCP
    DS_Redis -->|"ä»»åŠ¡é˜Ÿåˆ—"| CL_Executor

    %% é‡‡é›†å±‚åˆ°å¤„ç†å±‚ï¼ˆç»¿è‰²ï¼‰
    C_CCXT -->|"ç»Ÿä¸€æ•°æ®"| C_DataProvider
    C_DataProvider -->|"OHLCV"| P_Trend
    C_DataProvider -->|"OHLCV"| P_Momentum
    C_DataProvider -->|"OHLCV"| P_Volatility
    C_DataProvider -->|"OHLCV"| P_Volume
    C_PersonalData -->|"äº¤æ˜“å†å²"| P_Performance

    %% å¤„ç†å±‚å†…éƒ¨ï¼ˆç´«è‰²ï¼‰
    P_Trend --> P_Technical
    P_Momentum --> P_Technical
    P_Volatility --> P_Technical
    P_Volume --> P_Technical
    P_Technical --> P_Signals
    P_Sentiment --> P_Signals
    P_Patterns --> P_Signals
    
    P_Performance --> P_Risk
    P_Risk --> P_Attribution
    P_Attribution --> P_Behavior

    %% å¤„ç†å±‚åˆ°æ ¼å¼åŒ–å±‚ï¼ˆç´«è‰²ï¼‰
    P_Signals -->|"åˆ†æç»“æœ"| F_Report
    P_Behavior -->|"ç»©æ•ˆæ•°æ®"| F_Flexible

    %% AIç¼–æ’
    O_Router --> O_AIRoles
    O_AIRoles --> O_Providers
    O_Providers --> O_Tasks

    %% äº‘ç«¯ä»»åŠ¡
    CL_Scheduler --> CL_Publisher
    CL_Publisher --> CL_Executor
    CL_Executor --> CL_APIManager

    %% æ ¼å¼åŒ–å±‚åˆ°æ¶ˆæ¯ä¸­å¿ƒï¼ˆæ©™è‰²ï¼‰
    F_Report -->|"JSON/MD/HTML"| MB_MCP
    F_Flexible -->|"çµæ´»æŠ¥å‘Š"| MB_MCP
    F_JSON --> MB_MCP
    F_Markdown --> MB_MCP
    F_HTML --> MB_MCP

    %% æ¶ˆæ¯ä¸­å¿ƒåˆ°æ¶ˆè´¹å±‚ï¼ˆçº¢è‰²ï¼‰
    MB_MCP --> MB_Tools
    MB_Tools -->|"äº¤æ˜“å·¥å…·"| CO_Trading
    MB_Tools -->|"åˆ†æå·¥å…·"| CO_Analysis
    MB_Tools -->|"è´¦æˆ·å·¥å…·"| CO_Account
    MB_Tools -->|"å­¦ä¹ å·¥å…·"| CO_Learning

    %% æ¶ˆè´¹å±‚åˆ°å­˜å‚¨å±‚
    CO_Trading --> ST_File
    CO_Trading --> ST_Email
    CO_Analysis --> U_Cache
    CO_Learning --> ST_File

    %% å­˜å‚¨å±‚
    ST_File -.-> ST_Redis
    ST_Email -.-> ST_Notion

    %% å·¥å…·å±‚æ”¯æ’‘ï¼ˆè™šçº¿è¡¨ç¤ºæ”¯æ’‘å…³ç³»ï¼‰
    U_Logger -.->|"æ—¥å¿—æ”¯æ’‘"| MB_MCP
    U_Cache -.->|"ç¼“å­˜æ”¯æ’‘"| C_DataProvider
    U_RiskMgmt -.->|"é£æ§æ”¯æ’‘"| CO_Trading
    U_Backtest -.->|"å›æµ‹æ”¯æ’‘"| P_Signals
    U_Notifier -.->|"é€šçŸ¥æ”¯æ’‘"| ST_Email
    U_PerfMon -.->|"ç›‘æ§æ”¯æ’‘"| MB_MCP

    %% æ¶ˆè´¹å±‚åˆ°ç”¨æˆ·ç»ˆç«¯ï¼ˆç°è‰²ï¼‰
    MB_MCP -->|"MCPåè®®"| UT_Claude
    MB_MCP -->|"MCPåè®®"| UT_Windsurf
    CO_Trading -->|"æµ‹è¯•æ¥å£"| UT_Terminal
    CL_Executor -->|"å®šæ—¶ä»»åŠ¡"| UT_Qinglong

     %% æ–‡æ¡£èµ„äº§ï¼ˆç°è‰²è™šçº¿è¡¨ç¤ºæ–‡æ¡£å¼•ç”¨å…³ç³»ï¼‰
     MB_MCP -.->|"ä½¿ç”¨/é…ç½®è¯´æ˜"| DOC_User
     MB_MCP -.->|"æ¶æ„/è§„èŒƒ"| DOC_Dev

    %% åº”ç”¨æ ·å¼
    class DS_Binance,DS_OKX,DS_Bybit,DS_Config,DS_Redis datasource
    class C_CCXT,C_DataProvider,C_PersonalData collector
    class P_Trend,P_Momentum,P_Volatility,P_Volume,P_Technical,P_Sentiment,P_Patterns,P_Signals,P_Performance,P_Risk,P_Attribution,P_Behavior processor
    class F_Report,F_Flexible,F_JSON,F_Markdown,F_HTML formatter
    class MB_MCP,MB_Tools messagebus
    class CO_Trading,CO_Analysis,CO_Account,CO_Learning consumer
    class UT_Claude,UT_Windsurf,UT_Terminal,UT_Qinglong terminal
    class U_Logger,U_Cache,U_RiskMgmt,U_Backtest,U_Notifier,U_PerfMon utils
    class ST_File,ST_Redis,ST_Email,ST_Notion storage
     class DOC_User,DOC_Dev terminal
    class O_Router,O_AIRoles,O_Providers,O_Tasks,CL_Scheduler,CL_Publisher,CL_Executor,CL_APIManager processor
