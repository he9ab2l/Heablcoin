# 项目记录规范（历史记录 + 任务进度）

本项目的“项目记录”由两份文件共同构成：

- `历史记录.json`：用于记录“发生了什么变更”（按时间追加）。
- `任务进度.json`：用于记录“准备做什么/做到哪了”（项目拆解与进度）。

两者必须**同一时间基线、同一编码规范、同一写入流程**维护。

## 1. 合并方式（本项目统一采用）

**合并方式：双文件一体化维护（逻辑合并，不物理合并为单文件）。**

- 逻辑合并的含义：
  - 同一次工作（同一个功能交付）必须在两处同时落盘。
  - `历史记录.json` 负责“变更事实与影响面”，`任务进度.json` 负责“计划与完成度”。
- 不采用单文件合并的原因：
  - `历史记录.json` 适合作为不可变追加日志（audit trail）。
  - `任务进度.json` 适合作为可编辑的计划面板（progress board）。

## 2. 写入触发时机

- 当你**新增/修改/删除**功能或文档：
  - 必须追加一条 `历史记录.json` 记录。
  - 必须在 `任务进度.json` 中：
    - 新增任务或更新对应任务 `progress/status`。

## 3. 时间与编码规范（强制）

- 时间：统一使用北京时间字符串：`YYYY-MM-DD HH:mm:ss`
- 编码：所有记录文件必须为 UTF-8（无 BOM）。

## 4. 字段规范

### 4.1 历史记录（`历史记录.json`）

每条记录字段：

- `id`：北京时间 `YYYY-MM-DD HH:mm:ss`
- `user_intent`：一句话说明目的
- `details`：具体做了什么（可包含关键文件/模块说明）
- `change_type`：`add|modify|enhance|refactor|fix|optimize|clean|remove`
- `file_path`：受影响文件路径清单（建议逐步升级为数组；当前若为逗号分隔字符串也允许，但新增条目建议用数组）

### 4.2 任务进度（`任务进度.json`）

顶层字段：

- `last_updated`：北京时间 `YYYY-MM-DD HH:mm:ss`
- `projects[]`

每个项目字段：

- `project_id`：稳定 ID（不要包含版本号）
- `name`：项目名称（不要包含版本号，如 `v1/v2/v5.0` 等）
- `status`：`待办|进行中|已完成`
- `progress`：0-100
- `tasks[]`

每个任务字段：

- `task_id`：稳定 ID
- `description`：任务描述（不要包含版本号）
- `progress`：0-100
- `status`：`待办|进行中|已完成`
- `created_at`：北京时间 `YYYY-MM-DD HH:mm:ss`

## 5. 去重与合并规则（同一格式、持续沿用）

当出现“同一任务被重复记录/多种写法并存”时，采用以下合并规则：

- `任务进度.json`
  - 以 `project_id` 为主键；若历史上出现多个近似项目（例如名称里带 `v1/v2`），合并为一个项目：
    - `name` 取语义化且不带版本号的名称
    - `tasks` 合并去重：以 `task_id` 为主键；若 `task_id` 不一致但描述高度相似，则保留一条并在 `description` 中合并表述
- `历史记录.json`
  - 以 `id`（时间戳）为主键；同一时间点重复则保留更完整的一条
  - `file_path` 合并去重，确保覆盖面不丢失

## 6. 关联约定（推荐）

- 当一次工作对应某个 `project_id`：
  - 在 `历史记录.json.details` 的末尾增加 `关联任务：<project_id>/<task_id>`（便于追溯）

## 7. 提交前检查

- `python tests/run_tests.py unit`
- `python scripts/check_utf8.py`
- `python scripts/check_naming.py`
