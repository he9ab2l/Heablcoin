# API å‚è€ƒæ‰‹å†Œ ğŸ“š

æœ¬æ–‡æ¡£æä¾› Heablcoin MCP æœåŠ¡å™¨ä¸­æ‰€æœ‰å¯ç”¨å·¥å…·çš„å®Œæ•´å‚è€ƒã€‚

## MCP æ¥å…¥é€Ÿè§ˆ
- Claude Desktop `claude_desktop_config.json` ç¤ºä¾‹ï¼š
```json
{
  "mcpServers": {
    "heablcoin": {
      "command": "python",
      "args": ["d:/MCP/Heablcoin.py"],
      "env": { "PYTHONIOENCODING": "utf-8", "PYTHONUTF8": "1" }
    }
  }
}
```
- Windsurf `mcp_config.json` ç¤ºä¾‹åŒä¸Šï¼ˆè·¯å¾„è¯·æ›¿æ¢ä¸ºæœ¬æœºç»å¯¹è·¯å¾„ï¼‰ã€‚

## æ”¯æŒçš„ AI æä¾›å•†
é€šè¿‡ç¯å¢ƒå˜é‡å³å¯å¯ç”¨ä¸»æµæ¨¡å‹ï¼Œæœªé…ç½®æ—¶è‡ªåŠ¨å›é€€ç¦»çº¿ echoï¼š
- OpenAI å…¼å®¹ï¼šOpenAIã€DeepSeekã€Groqã€Moonshot (Kimi)ã€æ™ºè°± GLMã€å…¶ä»–å…¼å®¹ç«¯ç‚¹ï¼ˆå¯ç”¨ `OPENAI_BASE_URL`/`AI_DEFAULT_PROVIDER` æŒ‡å‘ï¼‰ã€‚
- åŸç”Ÿï¼šAnthropic (Claude)ã€Google Geminiã€‚
- è·¯ç”±ï¼š`AI_DEFAULT_PROVIDER` å†³å®šé»˜è®¤ï¼Œ`AI_ROUTE_ANALYSIS/CRITIQUE/SYNTHESIS/SAFETY` ä¸ºå¤šè§’è‰²è®¾ç½®ä¸“å± providerã€‚

---

## äº‘ç«¯ååŒæ–°å·¥å…·
- `consult_external_expert(query, model="deepseek", context="")`  
  è°ƒç”¨æŒ‡å®šå¤–éƒ¨ AI è·å–ç¬¬äºŒæ„è§ã€‚`model` æ”¯æŒ openai/deepseek/anthropic/gemini/groq/moonshot/zhipu ç­‰ã€‚  
  ç¤ºä¾‹ï¼š`consult_external_expert("BTC æŠ€æœ¯é¢æ€ä¹ˆçœ‹ï¼Ÿ", "deepseek", "{\\"timeframe\\":\\"4h\\"}")`

- `set_cloud_sentry(symbol, condition, action="notify", notes="")`  
  å°†ç›‘æ§ä»»åŠ¡å†™å…¥ Redisï¼ˆéœ€ `REDIS_URL`ï¼‰ï¼Œç”±é’é¾™ `qinglong_worker.py` è½®è¯¢æ‰§è¡Œã€‚condition æ”¯æŒ `price < 1000` ç­‰ç®€å•è¡¨è¾¾å¼ã€‚
  ç¤ºä¾‹ï¼š`set_cloud_sentry("BTC/USDT", "price < 95000", "email_alert", "è·Œç ´æ”¯æ’‘æé†’")`

- `sync_session_to_notion(summary, tags="")`  
  å°†å½“å‰ä¼šè¯æ‘˜è¦å†™å…¥ Notion æ—¥å¿—åº“ï¼ˆéœ€ `NOTION_*`ï¼‰ï¼Œ`tags` ç”¨é€—å·åˆ†éš”ã€‚
  ç¤ºä¾‹ï¼š`sync_session_to_notion("ä»Šæ—¥å¤ç›˜ï¼š...", "daily,trade")`

- `fetch_portfolio_snapshot()`  
  è¿”å›è´¦æˆ·èµ„äº§å¿«ç…§ï¼ˆåŸºäº `get_account_summary`ï¼‰ã€‚

- `get_learning_context()`  
  è¯»å– `dev/lessons.md` çš„äº¤æ˜“æ•™è®­/åå¥½ï¼Œç”¨äºä¸Šä¸‹æ–‡æ³¨å…¥ã€‚

## ğŸ¤– AI ä¸å¸‚åœºæ™ºèƒ½

### `get_ai_trading_advice`
ç”Ÿæˆ AI é©±åŠ¨çš„äº¤æ˜“åˆ†æå’Œå»ºè®®ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `symbol` | str | "BTC/USDT" | äº¤æ˜“å¯¹ |
| `mode` | str | "simple" | åˆ†ææ¨¡å¼ï¼š`simple`ï¼ˆç®€å•ï¼‰æˆ– `professional`ï¼ˆä¸“ä¸šï¼‰ |

**è¿”å›**: Markdown æ ¼å¼çš„åˆ†ææŠ¥å‘Š

**ç¤ºä¾‹**:
```
get_ai_trading_advice("BTC/USDT", "simple")
get_ai_trading_advice("ETH/USDT", "professional")
```

---

### `get_market_overview`
æä¾›åŠ å¯†è´§å¸å¸‚åœºå…¨æ™¯æ¦‚è§ˆã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `mode` | str | "simple" | `simple`ï¼ˆä¸»æµå¸æ¦‚è§ˆï¼‰æˆ– `professional`ï¼ˆè¯¦ç»†æ¿å—åˆ†æï¼‰ |

**è¿”å›**: Markdown æ ¼å¼çš„å¸‚åœºæ¦‚è§ˆ

---

### `get_trading_signals`
æ±‡æ€»å¤šä¸ªæŠ€æœ¯æŒ‡æ ‡çš„ä¿¡å·ï¼Œå½¢æˆç»¼åˆåˆ¤æ–­ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `symbol` | str | "BTC/USDT" | äº¤æ˜“å¯¹ |

**è¿”å›**: ä¿¡å·æ±‡æ€»ï¼ˆä¹°å…¥/å–å‡º/ä¸­æ€§ï¼‰åŠç½®ä¿¡åº¦

---

### `get_position_recommendation`
æ ¹æ®é£é™©å‚æ•°è®¡ç®—å»ºè®®ä»“ä½å¤§å°ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `symbol` | str | "BTC/USDT" | äº¤æ˜“å¯¹ |
| `account_balance` | float | None | è´¦æˆ·æ€»èµ„äº§ï¼ˆå¯é€‰ï¼Œé»˜è®¤è‡ªåŠ¨è·å–ï¼‰ |
| `risk_tolerance` | str | "moderate" | é£é™©åå¥½ï¼š`conservative`(1%)ã€`moderate`(2%)ã€`aggressive`(5%) |

**è¿”å›**: å»ºè®®ä»“ä½å¤§å°å’Œæ æ†

---

## ğŸ“Š å¸‚åœºåˆ†æ

### `get_market_analysis` **(æ”¯æŒå¯è§†åŒ–)**
ä¸»è¦çš„æŠ€æœ¯åˆ†æå·¥å…·ï¼Œæ”¯æŒåœ¨ Claude ä¸­ç”Ÿæˆäº¤äº’å¼å›¾è¡¨ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `symbol` | str | "BTC/USDT" | äº¤æ˜“å¯¹ |
| `timeframe` | str | "1h" | Kçº¿å‘¨æœŸï¼ˆå¦‚ "1h", "4h", "1d"ï¼‰ |
| `enable_visualization` | bool | True | æ˜¯å¦è¿”å›å¯è§†åŒ– JSON æ•°æ® |

**è¿”å›**: 
- `enable_visualization=True`: JSON å­—ç¬¦ä¸²ï¼ˆç”¨äºå›¾è¡¨æ¸²æŸ“ï¼‰
- `enable_visualization=False`: Markdown æ–‡æœ¬æŠ¥å‘Š

å½“ `enable_visualization=True` æ—¶ï¼Œè¿”å›çš„ JSON å°†åŒ…å«ï¼š
- `data.candles`: K çº¿æ•°ç»„ï¼ˆtimestamp/open/high/low/close/volumeï¼‰
- `data.indicators`: æŒ‡æ ‡åºåˆ—ï¼ˆå¦‚ RSIã€MACDã€SMA20ï¼‰
- `visualizations`: æ¸²æŸ“å»ºè®®ï¼ˆå¦‚ candlestick / lineï¼‰
- `summary`: æ–‡å­—æ‘˜è¦ï¼ˆå…œåº•ï¼‰

---

### `get_comprehensive_analysis`
æ·±åº¦æŠ€æœ¯åˆ†ææŠ¥å‘Šï¼ˆä¼ ç»Ÿå·¥å…·ï¼‰ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `symbol` | str | "BTC/USDT" | äº¤æ˜“å¯¹ |
| `timeframe` | str | "1h" | Kçº¿å‘¨æœŸ |

**è¿”å›**: è¯¦å°½çš„ Markdown æŠ€æœ¯åˆ†ææŠ¥å‘Š

---

### `get_market_sentiment`
åŸºäºä»·æ ¼è¡Œä¸ºå’Œæ³¢åŠ¨ç‡åˆ†æå¸‚åœºæƒ…ç»ªï¼ˆææƒ§ä¸è´ªå©ªï¼‰ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `symbol` | str | "BTC/USDT" | äº¤æ˜“å¯¹ |

**è¿”å›**: æƒ…ç»ªè¯„åˆ†ï¼ˆ0-100ï¼‰åŠè§£è¯»

---

### `get_multi_symbol_overview`
å¤šå¸ç§å¿«é€Ÿæ¦‚è§ˆã€‚

**å‚æ•°**: æ— 

**è¿”å›**: ä¸»æµå¸ç§çš„ä»·æ ¼ã€æ¶¨è·Œå¹…ã€RSI ç­‰å¿«ç…§

---

## ğŸ’¼ è´¦æˆ·ä¸äº¤æ˜“

### `get_account_summary`
è·å–å½“å‰é’±åŒ…ä½™é¢å’ŒæŒä»“æƒ…å†µã€‚

**è¿”å›**: å¯ç”¨èµ„äº§å’Œå·²ç”¨èµ„äº§æ˜ç»†

---

### `place_order`
åœ¨äº¤æ˜“æ‰€æ‰§è¡Œäº¤æ˜“ä¸‹å•ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `symbol` | str | - | äº¤æ˜“å¯¹ï¼ˆå¿…å¡«ï¼‰ |
| `side` | str | - | æ–¹å‘ï¼š`buy` æˆ– `sell`ï¼ˆå¿…å¡«ï¼‰ |
| `amount` | float | - | äº¤æ˜“æ•°é‡ï¼ˆå¿…å¡«ï¼‰ |
| `price` | float | None | é™ä»·å•ä»·æ ¼ï¼›ä¸º None æ—¶æ‰§è¡Œå¸‚ä»·å• |
| `order_type` | str | "market" | è®¢å•ç±»å‹ï¼š`market` æˆ– `limit` |

**è¿”å›**: è®¢å•æ‰§è¡Œç»“æœ

**ç¤ºä¾‹**:
```
place_order("BTC/USDT", "buy", 0.001, order_type="market")
place_order("ETH/USDT", "sell", 0.1, price=4000, order_type="limit")
```

---

### `get_open_orders`
åˆ—å‡ºå½“å‰æœªæˆäº¤çš„æŒ‚å•ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `symbol` | str | None | æŒ‰äº¤æ˜“å¯¹ç­›é€‰ï¼ˆå¯é€‰ï¼‰ |

**è¿”å›**: æŒ‚å•åˆ—è¡¨

---

### `cancel_order`
å–æ¶ˆæŒ‡å®šçš„æŒ‚å•ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `order_id` | str | è¦å–æ¶ˆçš„è®¢å• ID |
| `symbol` | str | è®¢å•çš„äº¤æ˜“å¯¹ |

**è¿”å›**: å–æ¶ˆçŠ¶æ€

---

### `execute_strategy`
æ‰§è¡ŒæŒ‡å®šçš„è‡ªåŠ¨äº¤æ˜“ç­–ç•¥ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `symbol` | str | äº¤æ˜“å¯¹ |
| `strategy` | str | ç­–ç•¥åç§°ï¼ˆå¦‚ "ma_crossover"ï¼‰ |
| `amount` | float | ç­–ç•¥è§¦å‘æ—¶çš„äº¤æ˜“é‡ |

**è¿”å›**: ç­–ç•¥æ‰§è¡Œç»“æœ

---

### `get_available_strategies`
æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„äº¤æ˜“ç­–ç•¥ã€‚

**è¿”å›**: ç­–ç•¥åˆ—è¡¨åŠè¯´æ˜

---

### `calculate_position_size`
è®¡ç®—é£æ§ä»“ä½å¤§å°ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `account_balance` | float | è´¦æˆ·ä½™é¢ |
| `entry_price` | float | å…¥åœºä»·æ ¼ |
| `stop_loss` | float | æ­¢æŸä»·æ ¼ |
| `risk_percent` | float | é£é™©æ¯”ä¾‹ï¼ˆé»˜è®¤ 2.0%ï¼‰ |

**è¿”å›**: å»ºè®®äº¤æ˜“æ•°é‡

---

## ğŸ“ˆ ä¸ªäººè´¦æˆ·åˆ†æ

åŸºäºæœ¬åœ°äº¤æ˜“è®°å½• (`trade_history.csv`) çš„åˆ†æå·¥å…·ã€‚

### `get_personal_analysis`
é€šç”¨ä¸ªäººç»©æ•ˆåˆ†æã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `modules` | str | "" | è¦è¿è¡Œçš„æ¨¡å—ï¼Œé€—å·åˆ†éš” |
| `limit` | int | 0 | åˆ†æçš„äº¤æ˜“æ•°é‡ï¼ˆ0=å…¨éƒ¨ï¼‰ |
| `initial_capital` | float | 10000.0 | åˆå§‹èµ„é‡‘ï¼Œç”¨äºè®¡ç®—æ”¶ç›Šç‡ |
| `return_format` | str | "markdown" | è¾“å‡ºæ ¼å¼ï¼š`markdown` æˆ– `json` |

**å¯ç”¨æ¨¡å—**:
- `performance`: ç»©æ•ˆåˆ†æï¼ˆROIã€èƒœç‡ã€å¤æ™®æ¯”ç‡ï¼‰
- `risk`: é£é™©åˆ†æï¼ˆæœ€å¤§å›æ’¤ã€è¿ç»­äºæŸï¼‰
- `attribution`: ç›ˆäºå½’å› ï¼ˆæŒ‰å¸ç§/æ–¹å‘/æ—¶é—´ï¼‰
- `behavior`: äº¤æ˜“è¡Œä¸ºåˆ†æ
- `portfolio`: æŠ•èµ„ç»„åˆåˆ†æï¼ˆæŒä»“ã€æµ®ç›ˆï¼‰
- `costs`: äº¤æ˜“æˆæœ¬åˆ†æï¼ˆæ‰‹ç»­è´¹ï¼‰
- `periods`: å‘¨æœŸæ€§ç»Ÿè®¡ï¼ˆæ—¥/å‘¨/æœˆæ”¶ç›Šï¼‰
- `sessions`: äº¤æ˜“æ—¶æ®µåˆ†æï¼ˆäºšæ¬§ç¾ç›˜ï¼‰
- `journal`: äº¤æ˜“å¤ç›˜
- `funds`: å‡ºå…¥é‡‘åˆ†æ

---

### `get_full_personal_analysis`
è·å–å®Œæ•´çš„ä¸ªäººäº¤æ˜“åˆ†ææŠ¥å‘Šï¼ˆè¿è¡Œæ‰€æœ‰æ¨¡å—ï¼‰ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `initial_capital` | float | 10000.0 | åˆå§‹èµ„é‡‘ |
| `return_format` | str | "markdown" | è¾“å‡ºæ ¼å¼ |

---

### `add_trade_journal_note`
ä¸ºç‰¹å®šäº¤æ˜“æ·»åŠ å¤ç›˜ç¬”è®°ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `order_id` | str | ç›®æ ‡äº¤æ˜“ ID |
| `note` | str | ç¬”è®°å†…å®¹ |
| `tags` | str | åˆ†ç±»æ ‡ç­¾ï¼Œé€—å·åˆ†éš”ï¼ˆå¦‚ "fomo, é”™è¯¯"ï¼‰ |

---

### `record_funds_flow`
è®°å½•å‡ºå…¥é‡‘ï¼Œç”¨äºè°ƒæ•´å‡€èµ„äº§è®¡ç®—ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `amount` | float | é‡‘é¢ï¼ˆæ­£æ•°ï¼‰ |
| `record_type` | str | ç±»å‹ï¼š`deposit`ï¼ˆå…¥é‡‘ï¼‰æˆ– `withdraw`ï¼ˆå‡ºé‡‘ï¼‰ |
| `currency` | str | å¸ç§ï¼Œé»˜è®¤ USDT |
| `note` | str | å¤‡æ³¨ |
| `date` | str | æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ï¼Œç•™ç©ºä¸ºä»Šå¤© |

---

## ğŸ”” ç³»ç»Ÿä¸é€šçŸ¥

### `get_system_status`
æ£€æŸ¥è¿æ¥çŠ¶æ€ã€å»¶è¿Ÿå’Œç³»ç»Ÿå¥åº·ã€‚

**è¿”å›**: ç³»ç»ŸçŠ¶æ€æŠ¥å‘Š

---

### `get_server_logs`
è·å–æœ€è¿‘çš„æ—¥å¿—æ¡ç›®ï¼Œç”¨äºè°ƒè¯•ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `lines` | int | 30 | è¿”å›çš„æ—¥å¿—è¡Œæ•° |

---

### `send_notification`
æ‰‹åŠ¨å‘é€è‡ªå®šä¹‰é‚®ä»¶é€šçŸ¥ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `title` | str | é‚®ä»¶æ ‡é¢˜ |
| `message` | str | é‚®ä»¶æ­£æ–‡ |

---

### `get_notification_settings`
æŸ¥çœ‹å½“å‰é€šçŸ¥è®¾ç½®ã€‚

**è¿”å›**: å„ç±»é€šçŸ¥çš„å¼€å…³çŠ¶æ€

---

### `set_notification_settings`
è¿è¡Œæ—¶é…ç½®é€šçŸ¥å¼€å…³ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `notify_trade_execution` | bool | äº¤æ˜“æ‰§è¡Œé€šçŸ¥ |
| `notify_price_alerts` | bool | ä»·æ ¼é¢„è­¦é€šçŸ¥ |
| `notify_daily_report` | bool | æ—¥æŠ¥é€šçŸ¥ |
| `notify_system_errors` | bool | ç³»ç»Ÿé”™è¯¯é€šçŸ¥ |
| `clear_overrides` | bool | æ¸…é™¤æ‰€æœ‰è¿è¡Œæ—¶è¦†ç›–ï¼Œæ¢å¤ .env é»˜è®¤ |

---

## ğŸ§¾ æŠ¥å‘Šç”Ÿæˆ

### `generate_analysis_report`
ç”Ÿæˆç»¼åˆåˆ†ææŠ¥å‘Šï¼Œå¯ä¿å­˜åˆ°æœ¬åœ°æˆ–å‘é€é‚®ä»¶ã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `symbol` | str | "BTC/USDT" | äº¤æ˜“å¯¹ |
| `mode` | str | "simple" | åˆ†ææ¨¡å¼ |
| `timeframe` | str | "1h" | Kçº¿å‘¨æœŸ |
| `save_local` | bool | True | æ˜¯å¦ä¿å­˜åˆ°æœ¬åœ° `reports/` ç›®å½• |
| `send_email_report` | bool | False | æ˜¯å¦å‘é€é‚®ä»¶ |

---

### `send_flexible_report`
å‘é€æ¨¡å—åŒ–çš„ HTML é‚®ä»¶æŠ¥å‘Šã€‚

**å‚æ•°**:
| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| `title` | str | "ç»¼åˆæŠ¥å‘Š" | æŠ¥å‘Šæ ‡é¢˜ |
| `send_A` ~ `send_I` | bool | False | æ§åˆ¶å‘é€å“ªäº›æ¨¡å— |

**è¿”å›**: å‘é€çŠ¶æ€
