# 说明文档

Heablcoin 的三种使用方式：MCP 对话式、终端脚本式、云端 Worker。

---

## 1. 三种使用方式

### 1.1 MCP 对话式（推荐）
- 适用：日常分析、策略讨论、对话触发工具
- 入口：Claude Desktop / Windsurf 作为 MCP Client
- Server：`Heablcoin.py`（配置里指向该脚本）

### 1.2 终端脚本式
- 适用：自检、批处理、开发调试
- 入口：
  - 自检：`python Heablcoin-test.py --quick`
  - 回归：`python tests/run_tests.py unit`

### 1.3 云端 Worker / Pipeline
- 适用：异步任务、监控哨兵、搜索/总结/通知
- 入口：
  - `qinglong_worker.py`（哨兵任务）
  - `src/core/cloud/pipeline_worker.py`（检索+LLM总结+多通道通知）

---

## 2. 最小可运行步骤（本地）

1) 安装依赖
- `pip install -r requirements.txt`

2) 准备 `.env`
- 从 `.env.example` 复制
- 最少建议配置：
  - 交易所：`BINANCE_API_KEY`、`BINANCE_SECRET_KEY`、`USE_TESTNET=True`
  - 日志：`LOG_LEVEL`（可选）

3) 快速自检
- `python Heablcoin-test.py --quick`

---

## 3. MCP 配置要点（Windows 简述）

- Claude Desktop 配置文件：`%APPDATA%\Claude\claude_desktop_config.json`
- Windsurf 配置文件：`%APPDATA%\Windsurf\mcp_config.json`
- 核心原则：
  - 使用 `Heablcoin.py` 的**绝对路径**
  - 设置 UTF-8：`PYTHONIOENCODING=utf-8`、`PYTHONUTF8=1`

---

## 4. 推荐工作流（从分析到执行）

### 4.1 分析 → 信号 → 仓位 →（可选）下单
- 市场分析：`get_market_analysis` 或 `get_comprehensive_analysis`
- 情绪：`get_market_sentiment`
- 信号汇总：`get_trading_signals`
- 仓位建议：`get_position_recommendation`
- 下单：`place_order`（强烈建议先 testnet）

### 4.2 生成日报/综合报告
- `generate_analysis_report(save_local=True)` 会写入 `reports/analysis_reports/...`
- 如启用邮件并打开通知开关，可 `send_email_report=True`

### 4.3 学习训练（提升纪律）
- 训练目录：`get_learning_catalog`
- 创建训练：`start_learning_session`
- 提交答案：`submit_learning_answer`
- 开启纪律拦截：`set_execution_guard_settings(enabled=True, trend_guard=True, ...)`

### 4.4 云端哨兵（价格条件触发通知）
- 写入哨兵任务：`set_cloud_sentry(symbol, condition, action, notes)`
- 由 `qinglong_worker.py` 轮询执行（需 Redis 环境变量）

---

## 5. 常用运维工具

- 系统状态：`get_system_status`
- 读日志：`get_server_logs(lines=...)`
- 性能统计：`get_performance_stats`
- 缓存统计/清理：`get_cache_stats` / `clear_cache(pattern)`
- 工具开关：`list_tools` / `set_tool_enabled` / `reset_tool_overrides`

---

## 6. 安全建议（重要）

- **先用测试网**：`USE_TESTNET=True`
- **不要提交 `.env`**：只提交 `.env.example`
- **谨慎开放下单工具**：必要时用 `TOOLS_DISABLED=place_order` 软禁用
- **避免 stdout 污染**：MCP Server 进程不要 `print()`
